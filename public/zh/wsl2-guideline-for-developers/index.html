<!DOCTYPE html>
<html lang="zh" dir="auto">
  <head>
    <script
      src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload"
      data-no-instant
      defer
    ></script>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="robots" content="noindex, nofollow" />
    <title>面向开发者的 WSL2 安装指南 | simpleapples</title>
    <meta name="keywords" content="" />
    <meta
      name="description"
      content="为什么要使用 Windows 做开发
一直以来 macOS 以类 unix 的特性，获得了程序员的青睐，但是近几年 Apple 在硬件领域少有让人耳目一新的产品，加上取消 Esc、使用蝶式键盘、基本为0的硬件可升级性、系统权限的收紧等骚操作，让 Mac 从软件到硬件都不如以前适合编程。另一方面，PC 阵营在软件层面保持开放的基础上，硬件体验也逐步赶上甚至超越 Mac，我也不想在用 Mac 做开发，用 PC 玩游戏，希望用一台电脑兼顾游戏和开发，所以选择回到了 PC 阵营。
随着微软拥抱开源领域，Windows 也开始变得程序员友好。Windows 10 2004 发布后，WSL2 也可以在正式版 Windows 10 中使用，相比于 macOS，WSL2 是一个原生 Linux 环境而非类 unix 环境，甚至可以在 App 商店中选择所需要的发行版。而相比于 WSL1，WSL2 采用了 HyperV 虚拟机的方式，解决了 WSL1 不能安装 Docker 等问题。
WSL1 和 WSL2
相比于 WSL1，WSL2 通过虚拟机的方式带来了更完整的 Linux 内核，但这种方式也引入了一些问题，微软给出了下面的图表来展示这些不同：

WSL2 不能和 VMWarework Station、VirtualBox 同时运行这一条已经过时了，VirtualBox 和 VMWare Workstation 都发布了支持 WSL2 和 Hyper-V 的新版。
WSL2 跨 OS 的磁盘性能的确低的令人发指，尤其是小文件，安装一个 Python 依赖可能需要等几分钟，安装一个 NodeJS 依赖&hellip;当我没说&hellip;相关 ISSUE 底下有无数吐槽，不过目前还没有人出来解决，在这里：https://github.com/microsoft/WSL/issues/4197）。不过微软在文档里也说了，有很多方式可以避免跨 OS 使用文件系统，比如使用 VSCode 的 remote deployment 功能，我认为这也是更好的实践，并且也这么做了。当然，如果你必须跨 OS 使用文件系统，还是乖乖留在 WSL1 吧（WSL1 太渣了，还是留在 VirtualBox 吧）。"
    />
    <meta name="author" content="" />
    <link
      rel="canonical"
      href="http://localhost:1313/zh/wsl2-guideline-for-developers/"
    />
    <link
      crossorigin="anonymous"
      href="/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css"
      integrity="sha256-j&#43;ECM6cGvIfy4Is8&#43;XuL1MCoDxBnWhQ2ddWSEhIQN8A="
      rel="preload stylesheet"
      as="style"
    />
    <link rel="icon" href="http://localhost:1313/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="http://localhost:1313/favicon-16x16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="http://localhost:1313/favicon-32x32.png"
    />
    <link
      rel="apple-touch-icon"
      href="http://localhost:1313/apple-touch-icon.png"
    />
    <link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg" />
    <meta name="theme-color" content="#2e2e33" />
    <meta name="msapplication-TileColor" content="#2e2e33" />
    <link
      rel="alternate"
      hreflang="zh"
      href="http://localhost:1313/zh/wsl2-guideline-for-developers/"
    />
    <noscript>
      <style>
        #theme-toggle,
        .top-link {
          display: none;
        }
      </style>
      <style>
        @media (prefers-color-scheme: dark) {
          :root {
            --theme: rgb(29, 30, 32);
            --entry: rgb(46, 46, 51);
            --primary: rgb(218, 218, 219);
            --secondary: rgb(155, 156, 157);
            --tertiary: rgb(65, 66, 68);
            --content: rgb(196, 196, 197);
            --code-block-bg: rgb(46, 46, 51);
            --code-bg: rgb(55, 56, 62);
            --border: rgb(51, 51, 51);
          }

          .list {
            background: var(--theme);
          }

          .list:not(.dark)::-webkit-scrollbar-track {
            background: 0 0;
          }

          .list:not(.dark)::-webkit-scrollbar-thumb {
            border-color: var(--theme);
          }
        }
      </style>
    </noscript>
  </head>

  <body class="" id="top">
    <script>
      if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add("dark");
      } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove("dark");
      } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        document.body.classList.add("dark");
      }
    </script>

    <header class="header">
      <nav class="nav">
        <div class="logo">
          <a
            href="http://localhost:1313/zh/"
            accesskey="h"
            title="simpleapples (Alt + H)"
            >simpleapples</a
          >
          <div class="logo-switches">
            <button
              id="theme-toggle"
              accesskey="t"
              title="(Alt + T)"
              aria-label="Toggle theme"
            >
              <svg
                id="moon"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
              <svg
                id="sun"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
            </button>
            <ul class="lang-switch">
              <li>|</li>
              <li>
                <a
                  href="http://localhost:1313/"
                  title="English"
                  aria-label="English"
                  >En</a
                >
              </li>
            </ul>
          </div>
        </div>
        <ul id="menu">
          <li>
            <a href="http://localhost:1313/zh/about/" title="about">
              <span>about</span>
            </a>
          </li>
          <li>
            <a href="http://localhost:1313/zh/categories/" title="categories">
              <span>categories</span>
            </a>
          </li>
        </ul>
      </nav>
    </header>
    <main class="main">
      <article class="post-single">
        <header class="post-header">
          <h1 class="post-title entry-hint-parent">
            面向开发者的 WSL2 安装指南
          </h1>
          <div class="post-meta">
            <span title="2020-06-01 19:02:00 +0000 +0000">六月 1, 2020</span>
          </div>
        </header>
        <div class="post-content">
          <h3 id="为什么要使用-windows-做开发">
            为什么要使用 Windows 做开发<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#为什么要使用-windows-做开发"
              >#</a
            >
          </h3>
          <p>
            一直以来 macOS 以类 unix 的特性，获得了程序员的青睐，但是近几年
            Apple 在硬件领域少有让人耳目一新的产品，加上取消
            Esc、使用蝶式键盘、基本为0的硬件可升级性、系统权限的收紧等骚操作，让
            Mac 从软件到硬件都不如以前适合编程。另一方面，PC
            阵营在软件层面保持开放的基础上，硬件体验也逐步赶上甚至超越
            Mac，我也不想在用 Mac 做开发，用 PC
            玩游戏，希望用一台电脑兼顾游戏和开发，所以选择回到了 PC 阵营。
          </p>
          <p>
            随着微软拥抱开源领域，Windows 也开始变得程序员友好。Windows 10 2004
            发布后，WSL2 也可以在正式版 Windows 10 中使用，相比于 macOS，WSL2
            是一个原生 Linux 环境而非类 unix 环境，甚至可以在 App
            商店中选择所需要的发行版。而相比于 WSL1，WSL2 采用了 HyperV
            虚拟机的方式，解决了 WSL1 不能安装 Docker 等问题。
          </p>
          <h3 id="wsl1-和-wsl2">
            WSL1 和 WSL2<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#wsl1-和-wsl2"
              >#</a
            >
          </h3>
          <p>
            相比于 WSL1，WSL2 通过虚拟机的方式带来了更完整的 Linux
            内核，但这种方式也引入了一些问题，微软给出了下面的图表来展示这些不同：
          </p>
          <p><img loading="lazy" src="/images/20200601_01.png" /></p>
          <p>
            WSL2 不能和 VMWarework Station、VirtualBox
            同时运行这一条已经过时了，VirtualBox 和 VMWare Workstation
            都发布了支持 WSL2 和 Hyper-V 的新版。
          </p>
          <p>
            WSL2 跨 OS 的磁盘性能的确低的令人发指，尤其是小文件，安装一个 Python
            依赖可能需要等几分钟，安装一个 NodeJS
            依赖&hellip;当我没说&hellip;相关 ISSUE
            底下有无数吐槽，不过目前还没有人出来解决，在这里：<a
              href="https://github.com/microsoft/WSL/issues/4197"
              >https://github.com/microsoft/WSL/issues/4197</a
            >）。不过微软在文档里也说了，有很多方式可以避免跨 OS
            使用文件系统，比如使用 VSCode 的 remote deployment
            功能，我认为这也是更好的实践，并且也这么做了。当然，如果你必须跨 OS
            使用文件系统，还是乖乖留在 WSL1 吧（WSL1 太渣了，还是留在 VirtualBox
            吧）。
          </p>
          <p>
            除了表格里说的，我认为 WSL2
            最大的问题在于&hellip;资源占用太大了&hellip;我是一台 16G
            内存的电脑，使用 WSL2 后开机就要吃掉 11G 的内存，虽然可以使用
            <code>wsl --shutdown</code> 关闭虚拟机释放资源，但是相比于
            VirtualBox 和 WSL1，WSL2 的资源占用可以说翻倍了。
          </p>
          <blockquote>
            <p>
              微软提供了限制 WSL2 资源的方式，参见<a
                href="https://docs.microsoft.com/en-us/windows/wsl/release-notes#build-18945"
                >https://docs.microsoft.com/en-us/windows/wsl/release-notes#build-18945</a
              >
            </p>
          </blockquote>
          <h3 id="要做些什么">
            要做些什么<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#要做些什么"
              >#</a
            >
          </h3>
          <p>
            好了，搞清楚 WSL2
            是什么之后接下来的问题就是怎么做了，这篇文章会指导你完成如下的安装流程：
          </p>
          <ul>
            <li>升级 Windows 10 到 2004</li>
            <li>启用 WSL2 并安装 Linux</li>
          </ul>
          <p>以及一些最佳实践：</p>
          <ul>
            <li>网络互通</li>
            <li>文件系统互通</li>
            <li>使用 Docker</li>
          </ul>
          <p>最后会聊聊 WSL2 的未来。</p>
          <h3 id="升级-windows-10-2004">
            升级 Windows 10 2004<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#升级-windows-10-2004"
              >#</a
            >
          </h3>
          <p>
            升级到 Windows 10 2004 有多种方法，最靠谱的还是从设置 -
            更新和安全里进行 OTA 升级，但是 Windows 的更新是分批推送的，2004
            更新有可能等到一两个月后才会出现在你的更新界面中。
          </p>
          <p>
            另一种更快速的方法是从官方地址下载镜像升级，访问这个地址下载运行就可以升级到最新的版本
            <a href="https://www.microsoft.com/software-download/windows10"
              >https://www.microsoft.com/software-download/windows10</a
            >，需要注意的是，发布初期可能 bug 含量会高一些，介意的还是再等等。
          </p>
          <h3 id="启用-wsl2">
            启用 WSL2<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#启用-wsl2"
              >#</a
            >
          </h3>
          <p>
            升级 Windows 10
            的过程不会碰到太多问题，升级后还需要进行一些配置才可以使用
            WSL2，首先要启用 Windows 子系统功能，使用管理员权限打开一个
            PowerShell 窗口，输入以下命令，并重启系统：
          </p>
          <div class="highlight">
            <pre
              tabindex="0"
              style="
                color: #f8f8f2;
                background-color: #272822;
                -moz-tab-size: 4;
                -o-tab-size: 4;
                tab-size: 4;
              "
            ><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>dism.exe /online /enable-feature /featurename<span style="color:#960050;background-color:#1e0010">:</span>Microsoft-Windows-Subsystem-Linux /all /norestart
</span></span></code></pre>
          </div>
          <p>
            重启后，Windows 默认启用的是 WSL1，还需要再启用虚拟机平台功能，在
            PowerShell 中输入以下命令，并再次重启系统：
          </p>
          <div class="highlight">
            <pre
              tabindex="0"
              style="
                color: #f8f8f2;
                background-color: #272822;
                -moz-tab-size: 4;
                -o-tab-size: 4;
                tab-size: 4;
              "
            ><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>dism.exe /online /enable-feature /featurename<span style="color:#960050;background-color:#1e0010">:</span>VirtualMachinePlatform /all /norestart
</span></span></code></pre>
          </div>
          <p>重启后，在 PowerShell 中输入以下命令，将 WSL 默认版本改为 WSL2:</p>
          <div class="highlight">
            <pre
              tabindex="0"
              style="
                color: #f8f8f2;
                background-color: #272822;
                -moz-tab-size: 4;
                -o-tab-size: 4;
                tab-size: 4;
              "
            ><code class="language-PowerShell" data-lang="PowerShell"><span style="display:flex;"><span>wsl --set-default-version <span style="color:#ae81ff">2</span>
</span></span></code></pre>
          </div>
          <p>
            接下来在 Microsoft Store 中找一个 Linux 发行版进行安装，安装后在
            PowerShell 中执行
            <code>wsl -l -v</code> 可以看到当前的发行版是否跑在 WSL2
            中，如果显示版本是1&hellip;请重复上面的安装步骤。
          </p>
          <blockquote>
            <p>
              设置 WSL 版本为 WSL2 报错时，请访问
              <a href="https://docs.microsoft.com/en-us/windows/wsl/wsl2-kernel"
                >https://docs.microsoft.com/en-us/windows/wsl/wsl2-kernel</a
              >
              下载 WSL2 Kernel。
            </p>
          </blockquote>
          <h3 id="网络互通">
            网络互通<a hidden class="anchor" aria-hidden="true" href="#网络互通"
              >#</a
            >
          </h3>
          <p>
            WSL2 不和 Windows 共享一个 localhost，所以不像 WSL1 中 Linux 和
            Windows 有无感知的网络互通性。
          </p>
          <p>
            Windows 访问 WSL2 启动的网络服务，可以直接使用 localhost，但是 Linux
            访问 Windows 启动的网络服务这种方式就不行了，可以使用如下脚本获取
            Windows 的 IP，并使用 IP 访问 Windows：
          </p>
          <div class="highlight">
            <pre
              tabindex="0"
              style="
                color: #f8f8f2;
                background-color: #272822;
                -moz-tab-size: 4;
                -o-tab-size: 4;
                tab-size: 4;
              "
            ><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ip route | grep default | awk <span style="color:#e6db74">&#39;{print $3}&#39;</span>
</span></span></code></pre>
          </div>
          <h3 id="文件系统互通">
            文件系统互通<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#文件系统互通"
              >#</a
            >
          </h3>
          <p>
            WSL2 访问 Windows 文件系统依然通过挂载分区的方式，Windows
            下的磁盘会被挂载在 <code>/mnt</code> 下，例如 <code>/mnt/c</code>。
          </p>
          <p>
            相比于 WSL1，这次增加了 Windows 访问 Linux
            分区的能力，可以在资源管理器中输入
            <code>\\wsl$\&lt;子系统名&gt;</code>
            访问对应的子系统分区，为了方便也可以在资源管理器中把 Linux
            分区挂载成一个磁盘。
          </p>
          <p>
            更加方便的一个方式是，在 Terminal 中，使用
            <code>explorer.exe .</code>
            可以直接调用资源管理器打开当前目录，有点类似 Mac 下的
            <code>open .</code>。
          </p>
          <h3 id="使用-docker">
            使用 Docker<a
              hidden
              class="anchor"
              aria-hidden="true"
              href="#使用-docker"
              >#</a
            >
          </h3>
          <p>
            WSL2 带来了完整的 Linux 内核，所以可以参照 Docker 在 Linux
            上安装的过程安装 Docker，并且可以正常使用，但是会有一个小瑕疵。WSL2
            的 systemd 吧&hellip;还不是原生的，也就是在 WSL1
            上就有的无法启动服务守护进程的问题依然存在，Docker
            服务自然也不能幸免。
          </p>
          <p>解决这个问题有三种方案：</p>
          <ul>
            <li>
              <p>
                可以让 Windows 执行开机脚本，通过脚本启动 WSL2 中的
                Docker，参见<a
                  href="https://blog.csdn.net/XhyEax/article/details/105560377"
                  >https://blog.csdn.net/XhyEax/article/details/105560377</a
                >，这种方案在 WSL1 时代就有，我自己使用过没碰到过问题。
              </p>
            </li>
            <li>
              <p>
                第二种方案是使用第三方工具运行 systemd，参见
                <a href="https://github.com/arkane-systems/genie"
                  >https://github.com/arkane-systems/genie</a
                >，原理是提供了一个单独的 namespace 跑 systemd。
              </p>
            </li>
            <li>
              <p>
                第三种方案是使用 Docker Desktop，2.3.0.2 以上版本已经支持 WSL2
                和 Hyper-V，免去一些折腾。
              </p>
            </li>
          </ul>
          <h3 id="gpu-支持">
            GPU 支持<a hidden class="anchor" aria-hidden="true" href="#gpu-支持"
              >#</a
            >
          </h3>
          <p>
            Build 2020 发出消息说 WSL2 要支持 GPU，Nvidia 也发出了 CUDA on WSL2
            的预览版，在这里：<a href="https://developer.nvidia.com/cuda/wsl"
              >https://developer.nvidia.com/cuda/wsl</a
            >。
          </p>
          <p>
            这意味着以后可以直接在 Windows 上使用 GPU
            加速训练模型了，虽然支持成都还很有限，但是相比于 Mac
            可领先了一个身位都不只了。
          </p>
          <h3 id="总结">
            总结<a hidden class="anchor" aria-hidden="true" href="#总结">#</a>
          </h3>
          <p>
            在体系结构上 WSL2 没有太大的创新，本质就是一台跑在 Hyper-V
            上的虚拟机，你可以使用 VMWare Workstation 或
            VirtualBox，经过简单的配置实现其 100%
            的功能，并且会有更高的性能，更少的资源占用，但是毕竟 WSL2
            是一项原生功能，其配置上的便利性和兼容性，大大减少了使用者花在配置上的精力，最大程度的实现开箱即用，这也是
            Apple 一直以来吸引开发者的主要原因。在这个时间点，使用 Windows +
            WSL2 来构建开发环境已经可以满足大部分的需求。
          </p>
          <h3 id="参考">
            参考<a hidden class="anchor" aria-hidden="true" href="#参考">#</a>
          </h3>
          <p>
            <a href="https://github.com/microsoft/WSL/issues/4197"
              >https://github.com/microsoft/WSL/issues/4197</a
            >
          </p>
          <p>
            <a href="https://docs.microsoft.com/en-us/windows/wsl/wsl2-kernel"
              >https://docs.microsoft.com/en-us/windows/wsl/wsl2-kernel</a
            >
          </p>
          <p>
            <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10"
              >https://docs.microsoft.com/en-us/windows/wsl/install-win10</a
            >
          </p>
          <p>
            <a href="https://github.com/arkane-systems/genie"
              >https://github.com/arkane-systems/genie</a
            >
          </p>
          <p>
            <a
              href="https://docs.microsoft.com/en-us/windows/wsl/release-notes#build-18945"
              >https://docs.microsoft.com/en-us/windows/wsl/release-notes#build-18945</a
            >
          </p>
          <p>
            <a href="https://developer.nvidia.com/cuda/wsl"
              >https://developer.nvidia.com/cuda/wsl</a
            >
          </p>
          <p>
            <a
              href="https://devblogs.microsoft.com/directx/directx-heart-linux/"
              >https://devblogs.microsoft.com/directx/directx-heart-linux/</a
            >
          </p>
        </div>

        <footer class="post-footer">
          <ul class="post-tags"></ul>
        </footer>
      </article>
    </main>

    <footer class="footer">
      <span
        >&copy; 2025 <a href="http://localhost:1313/zh/">simpleapples</a></span
      >
      ·

      <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank"
          >Hugo</a
        >
        &
        <a
          href="https://github.com/adityatelange/hugo-PaperMod/"
          rel="noopener"
          target="_blank"
          >PaperMod</a
        >
      </span>
    </footer>
    <a
      href="#top"
      aria-label="go to top"
      title="Go to Top (Alt + G)"
      class="top-link"
      id="top-link"
      accesskey="g"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 12 6"
        fill="currentColor"
      >
        <path d="M12 6H0l6-6z" />
      </svg>
    </a>

    <script>
      let menu = document.getElementById("menu");
      if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
          localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        };
      }

      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          var id = this.getAttribute("href").substr(1);
          if (!window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
            document
              .querySelector(`[id='${decodeURIComponent(id)}']`)
              .scrollIntoView({
                behavior: "smooth",
              });
          } else {
            document
              .querySelector(`[id='${decodeURIComponent(id)}']`)
              .scrollIntoView();
          }
          if (id === "top") {
            history.replaceState(null, null, " ");
          } else {
            history.pushState(null, null, `#${id}`);
          }
        });
      });
    </script>
    <script>
      var mybutton = document.getElementById("top-link");
      window.onscroll = function () {
        if (
          document.body.scrollTop > 800 ||
          document.documentElement.scrollTop > 800
        ) {
          mybutton.style.visibility = "visible";
          mybutton.style.opacity = "1";
        } else {
          mybutton.style.visibility = "hidden";
          mybutton.style.opacity = "0";
        }
      };
    </script>
    <script>
      document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
          document.body.classList.remove("dark");
          localStorage.setItem("pref-theme", "light");
        } else {
          document.body.classList.add("dark");
          localStorage.setItem("pref-theme", "dark");
        }
      });
    </script>
  </body>
</html>
